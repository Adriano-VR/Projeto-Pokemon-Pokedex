<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="mudarCorClasse.css">
    <title>POKEDEX</title>
</head>

<body>
    <main>
            <div id="texto">
               <a href="index.html"><img src="assets/icon/211618_c_left_arrow_icon.png" alt=""></a>
                <h1>POKEDEX</h1>
                
            </div>
        <div id="principal"></div>
    </main>
    <script src="script.js"></script>
    <script>
        const storedArray = sessionStorage.getItem('pokedex');
        const arrayPokedex = storedArray ? JSON.parse(storedArray) : [];

        const storedArray1 = sessionStorage.getItem('arrayPokemons');
        const arrayPokemons = storedArray1 ? JSON.parse(storedArray1) : [];
 
        function criarDivPokemons() {
            const pokedexDiv = document.getElementById('principal');
            pokedexDiv.innerHTML = ''; // Limpa o conteúdo antes de recriar

            if (storedArray) {
                arrayPokedex.forEach(pokemon => {
                    createElements(pokemon,'pokedex');
                });
            }
        }

        function removerPokedex(id) {
            const pokemonRemovido = removerPokedexArray(id);

            if (pokemonRemovido) {
                arrayPokemons.push(pokemonRemovido); // Adiciona o Pokémon de volta ao arrayPokemons

                sessionStorage.setItem('pokedex', JSON.stringify(arrayPokedex));
                sessionStorage.setItem('arrayPokemons', JSON.stringify(arrayPokemons));

                removerDiv(id);
            }
        }

        function removerDiv(id) {
            const divRemover = document.getElementById(`pokemon-${id}`);
            if (divRemover) {
                divRemover.remove();
            }
        }


        function removerPokedexArray(id) {
            const index = arrayPokedex.findIndex(pokemon => pokemon.id === id);

            if (index !== -1) {
                const pokemonRemovido = arrayPokedex.splice(index, 1)[0];
                sessionStorage.setItem('pokedex', JSON.stringify(arrayPokedex));
                return pokemonRemovido;
            }
            return null;
        }

   
        function iniciarDueloPokedex(idUsuario) {
            const adversarioId = prompt("Escolha o ID do Pokémon adversário da Pokedex:");
           
           
            const pokemonUsuario = arrayPokedex.find(p => p.id === idUsuario);
            const idDesafiante = arrayPokedex.find(p => p.id === parseInt(adversarioId));

            if (!pokemonUsuario || !idDesafiante) {
                alert('Invalido ids');
                return;
            }

            alert(`Comecou!\n\n${pokemonUsuario.nome} vs. ${idDesafiante.nome}`);

            const resultadoDuelo = calcularVencedor(idUsuario, idDesafiante);

            alert(`Resultado do duelo:\n\n${pokemonUsuario.nome} ${resultadoDuelo} ${idDesafiante.nome}`);
        }

        function calcularVencedor(id, adversario) {
            const statsUsuario = arrayPokedex.find(p => p.id === id);
           
          
            const poderUsuario = statsUsuario.stats.reduce((total, stat) => total + stat.valor, 0); // reduce soma todas as stats comeca em 0
            const poderAdversario = adversario.stats.reduce((total, stat) => total + stat.valor, 0);

            console.log('poder usurioa ' + poderUsuario )
            console.log('poder adversario ' + poderAdversario)
            if (poderUsuario > poderAdversario) {
                return 'vence contra '
            } else if (poderUsuario < poderAdversario) {
                return ' perde para '
            } else {
                return 'empata com';
            }
        }

   

          
        
        criarDivPokemons();
    </script>
</body>

</html>