<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="detalhes.css">
    <link rel="stylesheet" href="mudarCorClasse.css">
    <title>Detalhes do Pokémon</title>
    <link rel="icon" href="assets/icon/pokebola.ico" type="image/x-icon">

</head>

<body>

    <div id="texto">
        <a href="index.html"><img src="assets/icon/211618_c_left_arrow_icon.png" alt=""></a>
        <h1>Detalhes</h1>

    </div>

    <div class="container-geral-detalhes">
        <section id="pokemonDetails">



        </section>


    </div>


    <div>
        <div id="containerDeBarras"></div>
    </div>
    <a href="pokedex.html">
        <img src="assets/icon/pokebola.png" alt="">
    </a>
    <script src="script.js"></script>
    <script>
        const storedArray = sessionStorage.getItem('pokedex');
        const arrayPokedex = storedArray ? JSON.parse(storedArray) : [];

        const storedArray1 = sessionStorage.getItem('arrayPokemons');
        const arrayPokemons = storedArray1 ? JSON.parse(storedArray1) : [];


        window.onload = carregarDetalhesDoPokemon;

        async function carregarDetalhesDoPokemon() {
            const parametrosURL = new URLSearchParams(window.location.search);
            const id = parametrosURL.get('id');

            const arrayPokemonsArmazenado = sessionStorage.getItem('arrayPokemons');
            const arrayPokemons = arrayPokemonsArmazenado ? JSON.parse(arrayPokemonsArmazenado) : [];

            const pokemon = arrayPokemons.find(p => p.id === parseInt(id));
            

            const divDetalhesPokemon = document.getElementById('pokemonDetails');
            const descricao = await getPokemonDescription(pokemon.id)
            
            divDetalhesPokemon.innerHTML = `
                <div id='content-primeira'>
            <span>${pokemon.id}</span>
            <ul>
                    ${pokemon.tipo.map(tipo => `<li>${tipo.toUpperCase()}</li>`).join('')}
                </ul>

                <h2>${pokemon.nome}</h2>
                <p>${descricao}</p>
                <div id='container-btn'>
                    <button id='btn' onclick='addPokedex(${pokemon.id},"${pokemon.nome}","${pokemon.imgFrente}","${pokemon.imgCostas}",${JSON.stringify(pokemon.tipo)},${JSON.stringify(pokemon.stats)},${JSON.stringify(pokemon.moves)})'>Add Pokedex</button>

                    </div>
                </div>
                <div id='content-segunda'>
            
                <h3>Moves:</h3>
                <ul>
                    ${pokemon.moves.map(move => `<li>${move.toUpperCase()}</li>`).join('')}
                </ul>
                <h3>Estatísticas:</h3>
                <ul>
                    ${pokemon.stats.map(stat => `<li>${stat.nome.toUpperCase()} - ${stat.valor}</li>`).join('')}
                </ul>
                <h3>Imagens:</h3>
                <ul id='imagens'>
                   <img src='${pokemon.imgCostas}'> </img>
                   <img src='${pokemon.imgFrente}'> </img>
                    
                </ul>
            </div>

            </div>    
            `;

            divDetalhesPokemon.style.backgroundColor = corPorTipo(pokemon).corBackground;
            divDetalhesPokemon.style.color = corPorTipo(pokemon).corTexto
            document.querySelectorAll('h3').forEach(element => {
                element.style.color = corPorTipo(pokemon).corTexto
            });

        }






        function addPokedex(id, nomePokemon, imgFrente, imgCostas, tipos, estatisticas, moves) {



            const pokemon = {
                id: id,
                nome: nomePokemon,
                imgFrente: imgFrente,
                imgCostas: imgCostas,
                tipo: tipos,
                stats: estatisticas,
                moves: moves
            };

            const pokemonExistente = arrayPokedex.find(p => p.id === id);

            if (pokemonExistente) {
                alert(`Pokemon "${pokemon.nome}" já está na Pokedex.`);
                return;
            }

            arrayPokedex.push(pokemon);
            removerPokemon(id);

            sessionStorage.setItem('pokedex', JSON.stringify(arrayPokedex));
            sessionStorage.setItem('arrayPokemons', JSON.stringify(arrayPokemons));

            const botao = document.getElementById('btn');
            botao.innerHTML = '';
            botao.classList.add('adicionado');
            botao.style.scale = '1.6'
            botao.style.backgroundColor = 'transparent';
            botao.style.transition = '1s ease'
            botao.setAttribute('disabled', 'true');


            console.log(`Pokemon "${pokemon.nome}" adicionado à Pokedex.`);
        }

        function removerPokemon(id) {
            const index = arrayPokemons.findIndex(pokemon => pokemon.id === id);

            if (index !== -1) {
                arrayPokemons.splice(index, 1);
                sessionStorage.setItem('arrayPokemons', JSON.stringify(arrayPokemons));

                console.log(`Pokemon com ID ${id} removido da lista.`);
            } else {
                console.error(`Pokemon com ID ${id} não encontrado na lista.`);
            }
        }

        function getPokemonDescription(id) {
            return fetch(`https://pokeapi.co/api/v2/pokemon-species/${id}/`)
                .then(response => response.json())
                .then(speciesData => {
                    const descricao = speciesData.flavor_text_entries.find(entry => entry.language.name === 'en').flavor_text;
                    return descricao;
                })
                .catch(error => {
                    console.error(`Erro ao obter descrição: ${error.message}`);
                    return "Erro ao obter descrição.";
                });
        }

        function barra(pokemon) {
            pokemon.stats.forEach(stat => {
                const hp = stat.valor;
                const nomeDaEstatistica = stat.nome;
                const larguraBarra = `${hp}%`;


                const barraDeProgresso = document.createElement('div');
                barraDeProgresso.className = 'barraDeProgresso';


                const barraDeProgressoInterior = document.createElement('div');
                barraDeProgressoInterior.className = 'barraDeProgressoInterior';
                barraDeProgressoInterior.style.width = larguraBarra;
                barraDeProgressoInterior.style.backgroundColor = corPorTipo(pokemon).corBackground


                barraDeProgresso.appendChild(barraDeProgressoInterior);


                const nomeElemento = document.createElement('div');
                nomeElemento.className = 'nomeDaEstatistica';
                nomeElemento.textContent = nomeDaEstatistica;


                barraDeProgresso.appendChild(nomeElemento);


                containerDeBarras.appendChild(barraDeProgresso);
            });
        }

    </script>
</body>

</html>